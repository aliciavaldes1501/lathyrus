"2008","2008","2008","2008","2009","2009","2009","2009","2010","2010","2010","2010",
"2011","2011","2011","2011","2012","2012","2012","2012","2013","2013","2013","2013",
"2014","2014","2014","2014","2015","2015","2015","2015","2016","2016","2016","2016",
"2017","2017","2017","2017")
5*22
sel_models2_anova<-cbind(
year=c("1987","1987","1987","1987","1987","1988","1988","1988","1988","1988",
"1989","1989","1989","1989","1989","1990","1990","1990","1990","1990",
"1991","1991","1991","1991","1991","1992","1992","1992","1992","1992",
"1993","1993","1993","1993","1993","1994","1994","1994","1994","1994",
"1995","1995","1995","1995","1995","1996","1996","1996","1996","1996",
"2006","2006","2006","2006","2006","2007","2007","2007","2007","2007",
"2008","2008","2008","2008","2008","2009","2009","2009","2009","2009",
"2010","2010","2010","2010","2010","2011","2011","2011","2011","2011",
"2012","2012","2012","2012","2012","2013","2013","2013","2013","2013",
"2014","2014","2014","2014","2014","2015","2015","2015","2015","2015",
"2016","2016","2016","2016","2016","2017","2017","2017","2017","2017"),
variable=rep(c("FFD_std","I(FFD_std^2)","n_fl_std","I(n_fl_std^2)","FFD_std:n_fl_std"),22),
ldply(lapply(as.list(sel_models3)$model,FUN=Anova), function(x) data.frame(x)[1:5,3:4]))
sel_models2_anova$sig<-ifelse(sel_models2_anova$Pr..F.<0.05,"*","")
kable(sel_models3_anova)
# Chunk 1: load image and packages
load(file = "C:/Users/User/Dropbox/SU/Projects/lathyrus/code/image1.RData")
library(plyr)
library(dplyr)
library(broom)
library(knitr)
library(car)
# Chunk 2: Select data and look at variables
data_sel<-subset(alldata_weather_subs,!is.na(n_fl)&!is.na(FFD))
nrow(subset(data_sel,is.na(n_intact_seeds))) #No NAs for seed data
with(data_sel,hist(FFD))
with(data_sel,hist(n_fl))
with(data_sel,hist(n_intact_seeds))
# Chunk 3: Relative fitness and standardized traits
data_sel<-data.frame(
data_sel %>%
group_by(year) %>%
mutate(n_intact_seeds_rel=n_intact_seeds/mean(n_intact_seeds)) %>% #Relative fitness
mutate(FFD_std=(FFD-mean(FFD))/sd(FFD)) %>%  #Standardized FFD
mutate(n_fl_std=(n_fl-mean(n_fl))/sd(n_fl))) #Standardized n_fl
# Chunk 4
Anova(lm(n_intact_seeds_rel ~ FFD_std+FFD_std:year, data = data_sel),type="II")
#Not sure about type - II for interactions?
#Selection for early flowering differs among years
Anova(lm(n_intact_seeds_rel ~ FFD_std+FFD_std:year+n_fl_std+n_fl_std:year, data = data_sel),type="II")
#Selection for early flowering does not differ among years
Anova(update(lm(n_intact_seeds_rel ~ (FFD_std+I(FFD_std^2))*year, data = data_sel),.~.-year),type="II")
Anova(update(lm(n_intact_seeds_rel ~ (FFD_std+I(FFD_std^2)+n_fl_std+I(n_fl_std^2)+FFD_std:n_fl_std)
*year, data = data_sel),.~.-year),type="II")
#No evidence of non-linear selection
# Chunk 5: Selection models with FFD
sel_models1<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std, data = .))
sel_models1_coefs<-data.frame(sel_models1 %>% tidy(model))
sel_models1_coefs$sig<-ifelse(sel_models1_coefs$p.value<0.05,"*","")
sel_models1_rsq<-data.frame(sel_models1 %>% glance(model))[1:3]
sel_models1_anova<-cbind(
year=c("1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","2006","2007",
"2008","2009","2010","2011","2012","2013","2014","2015","2016","2017"),
variable=rep(c("FFD_std"),22),
ldply(lapply(as.list(sel_models1)$model,FUN=Anova), function(x) data.frame(x)[1,3:4]))
sel_models1_anova$sig<-ifelse(sel_models1_anova$Pr..F.<0.05,"*","")
kable(sel_models1_coefs)  #FFD * in all years but 1995,2009,2013,2015,2017
kable(sel_models1_rsq)
kable(sel_models1_anova)
# Chunk 6: Selection models with FFD & n_fl
sel_models2<-as.list(data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .)) )
sel_models2<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .))
sel_models2_coefs<-data.frame(sel_models2 %>% tidy(model))
sel_models2_coefs$sig<-ifelse(sel_models2_coefs$p.value<0.05,"*","")
sel_models2_rsq<-data.frame(sel_models2 %>% glance(model))[1:3]
sel_models2_anova<-cbind(
year=c("1987","1987","1988","1988","1989","1989","1990","1990","1991","1991","1992","1992","1993","1993",
"1994","1994","1995","1995","1996","1996","2006","2006","2007","2007","2008","2008","2009","2009",
"2010","2010","2011","2011","2012","2012","2013","2013","2014","2014","2015","2015","2016","2016",
"2017","2017"),
variable=rep(c("FFD_std","n_fl_std"),22),
ldply(lapply(as.list(sel_models2)$model,FUN=Anova), function(x) data.frame(x)[1:2,3:4]))
sel_models2_anova$sig<-ifelse(sel_models2_anova$Pr..F.<0.05,"*","")
kable(sel_models2_coefs)  #FFD * in 1991,1992,1993,2007,2010,2012,2014
kable(sel_models2_rsq)
kable(sel_models2_anova)
sel_models3<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+I(FFD_std^2)+n_fl_std+I(n_fl_std^2)+FFD_std:n_fl_std
, data = .))
sel_models3_coefs<-data.frame(sel_models3 %>% tidy(model))
sel_models3_coefs$sig<-ifelse(sel_models3_coefs$p.value<0.05,"*","")
sel_models3_rsq<-data.frame(sel_models3 %>% glance(model))[1:3]
sel_models3_anova<-cbind(
year=c("1987","1987","1987","1987","1987","1988","1988","1988","1988","1988",
"1989","1989","1989","1989","1989","1990","1990","1990","1990","1990",
"1991","1991","1991","1991","1991","1992","1992","1992","1992","1992",
"1993","1993","1993","1993","1993","1994","1994","1994","1994","1994",
"1995","1995","1995","1995","1995","1996","1996","1996","1996","1996",
"2006","2006","2006","2006","2006","2007","2007","2007","2007","2007",
"2008","2008","2008","2008","2008","2009","2009","2009","2009","2009",
"2010","2010","2010","2010","2010","2011","2011","2011","2011","2011",
"2012","2012","2012","2012","2012","2013","2013","2013","2013","2013",
"2014","2014","2014","2014","2014","2015","2015","2015","2015","2015",
"2016","2016","2016","2016","2016","2017","2017","2017","2017","2017"),
variable=rep(c("FFD_std","I(FFD_std^2)","n_fl_std","I(n_fl_std^2)","FFD_std:n_fl_std"),22),
ldply(lapply(as.list(sel_models3)$model,FUN=Anova), function(x) data.frame(x)[1:5,3:4]))
sel_models3_anova$sig<-ifelse(sel_models3_anova$Pr..F.<0.05,"*","")
kable(sel_models3_coefs)  #Quadratic selection only in 2008,2012
kable(sel_models3_rsq)
kable(sel_models3_anova)
#Correlational selection in 1988, 2016
#Quadratic selection on n_fl in 1990, 2006, 2015 and on FFD in 2015
kable(sel_models3_rsq)
kable(sel_models3_anova)
kable(sel_models2_coefs)  #FFD * in 1991,1992,1993,2007,2010,2012,2014
sel_models2_coefs
str(sel_models2_coefs)
sel_models2_coefs
sel_grads_FFD<-subset(sel_models2_coefs,term=="FFD_std")
sel_grads_FFD
sel_grads_FFD<-subset(sel_models2_coefs,term=="FFD_std")[c(1,3,7)]
sel_grads_FFD
with(sel_grads_FFD,plot(estimate~year))
ggplot(sel_grads_FFD,aes(year,estimate))+geom_point()
library(ggplot2)
ggplot(sel_grads_FFD,aes(year,estimate))+geom_point()
ggplot(sel_grads_FFD,aes(year,estimate,colour=sig))+geom_point()
kable(sel_models2_coefs)  #FFD * in 1991,1992,1993,2007,2010,2012,2014
ggplot(sel_grads_FFD,aes(year,estimate,colour=sig))+geom_point()+
scale_color_manual(labels = c("NS", "Signif"), values = c("blue", "red"))
ggplot(sel_grads_FFD,aes(year,estimate,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("NS", "Signif"), values = c("blue", "red"))
ggplot(sel_grads_FFD,aes(year,estimate,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("NS", "Signif"), values = c("blue", "red"))+
geom_hline(yintercept=0)
ggplot(sel_grads_FFD,aes(year,estimate,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("NS", "Signif"), values = c("blue", "red"))+
geom_hline(yintercept=0)+ggtitle("Selection gradients for each year")
ggplot(sel_grads_FFD,aes(year,estimate,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("Not significant", "Significant"), values = c("blue", "red"))+
geom_hline(yintercept=0)+ggtitle("Selection gradients for each year")+theme(legend.position="top")
ggplot(sel_grads_FFD,aes(estimate,year,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("Not significant", "Significant"), values = c("blue", "red"))+
geom_hline(yintercept=0)+ggtitle("Selection gradients for each year")+theme(legend.position="top")
ggplot(sel_grads_FFD,aes(estimate,year,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("Not significant", "Significant"), values = c("blue", "red"))+
geom_vline(xintercept=0)+ggtitle("Selection gradients for each year")+theme(legend.position="top")
head(alldata_agg)
head(mean_weather5)
mean_weather5
head(sel_grads_FFD)
sel_grads_FFD$signif<-as.factor(with(sel_grads,ifelse(sig=="*","1","0")))
sel_grads_FFD$signif<-as.factor(with(sel_grads_FFD,ifelse(sig=="*","1","0")))
sel_grads_FFD
sel_grads_FFD
sel_grads_FFD$sig<-NULL
sel_grads_FFD
names(sel_grads_FFD)<-c("year","selgradFFD","sig_selgradFFD")
sel_grads_FFD
data_sel_agg<-merge(mean_weather5,sel_grads_FFD)
data_sel_agg
names(data_sel_agg)
data_sel_agg<-merge(mean_weather5,sel_grads_FFD)[c(1,146:228,230:231)]
data_sel_agg
with(data_sel_agg,hist(selgradFFD))
with(data_sel_agg,summary(lm(selgradFFD~mean45)))
with(data_sel_agg,plot(selgradFFD~mean45))
names(data_sel_agg)
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(2:84)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
models_selgrads
#Build a table with estimate, p and r square for all fitted models
models_selgrads<-cbind(names(data_sel_agg)[c(2:84)],
ldply(models_selgrads, function(x) coef(x)[2]),
ldply(models_selgrads, function(x) coef(x)[8]),
ldply(models_selgrads, function(x) x$adj.r.square)
)
names(models_selgrads)<-c("variable","estimate","p","adj.rsquare")
models_selgrads$sig<-ifelse(models_selgrads$p<0.05,"*","") # *=p<0.05
#Order models by R square
kable(arrange(models_selgrads,desc(adj.rsquare)))
data_sel_agg<-merge(mean_weather5,sel_grads_FFD)
names(data_sel_agg)
names(data_sel_agg)
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(2:228)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
data_sel_agg<-merge(mean_weather5,sel_grads_FFD)
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(2:228)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
names(data_sel_agg)[c(2:228)]
rm(models_selgrads)
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(2:228)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(3:228)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(2:228)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(3:228)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
#Build a table with estimate, p and r square for all fitted models
models_selgrads<-cbind(names(data_sel_agg)[c(2:228)],
ldply(models_selgrads, function(x) coef(x)[2]),
ldply(models_selgrads, function(x) coef(x)[8]),
ldply(models_selgrads, function(x) x$adj.r.square)
)
#Build a table with estimate, p and r square for all fitted models
models_selgrads<-cbind(names(data_sel_agg)[c(3:228)],
ldply(models_selgrads, function(x) coef(x)[2]),
ldply(models_selgrads, function(x) coef(x)[8]),
ldply(models_selgrads, function(x) x$adj.r.square)
)
names(models_selgrads)<-c("variable","estimate","p","adj.rsquare")
models_selgrads$sig<-ifelse(models_selgrads$p<0.05,"*","") # *=p<0.05
#Order models by R square
kable(arrange(models_selgrads,desc(adj.rsquare)))
names(data_sel_agg)
data_sel_agg$GGD_10_1
data_sel_agg$GDD_10_1
data_sel_agg$GDD10_1
# Chunk 1: load image and packages
load(file = "C:/Users/User/Dropbox/SU/Projects/lathyrus/code/image1.RData")
library(plyr)
library(dplyr)
library(broom)
library(knitr)
library(car)
library(ggplot2)
# Chunk 2: Select data and look at variables
data_sel<-subset(alldata_weather_subs,!is.na(n_fl)&!is.na(FFD))
nrow(subset(data_sel,is.na(n_intact_seeds))) #No NAs for seed data
with(data_sel,hist(FFD))
with(data_sel,hist(n_fl))
with(data_sel,hist(n_intact_seeds))
# Chunk 3: Relative fitness and standardized traits
data_sel<-data.frame(
data_sel %>%
group_by(year) %>%
mutate(n_intact_seeds_rel=n_intact_seeds/mean(n_intact_seeds)) %>% #Relative fitness
mutate(FFD_std=(FFD-mean(FFD))/sd(FFD)) %>%  #Standardized FFD
mutate(n_fl_std=(n_fl-mean(n_fl))/sd(n_fl))) #Standardized n_fl
# Chunk 4
Anova(lm(n_intact_seeds_rel ~ FFD_std+FFD_std:year, data = data_sel),type="II")
#Not sure about type - II for interactions?
#Selection for early flowering differs among years
Anova(lm(n_intact_seeds_rel ~ FFD_std+FFD_std:year+n_fl_std+n_fl_std:year, data = data_sel),type="II")
#Selection for early flowering does not differ among years
Anova(update(lm(n_intact_seeds_rel ~ (FFD_std+I(FFD_std^2))*year, data = data_sel),.~.-year),type="II")
Anova(update(lm(n_intact_seeds_rel ~ (FFD_std+I(FFD_std^2)+n_fl_std+I(n_fl_std^2)+FFD_std:n_fl_std)
*year, data = data_sel),.~.-year),type="II")
#No evidence of non-linear selection
# Chunk 5: Selection models with FFD
sel_models1<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std, data = .))
sel_models1_coefs<-data.frame(sel_models1 %>% tidy(model))
sel_models1_coefs$sig<-ifelse(sel_models1_coefs$p.value<0.05,"*","")
sel_models1_rsq<-data.frame(sel_models1 %>% glance(model))[1:3]
sel_models1_anova<-cbind(
year=c("1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","2006","2007",
"2008","2009","2010","2011","2012","2013","2014","2015","2016","2017"),
variable=rep(c("FFD_std"),22),
ldply(lapply(as.list(sel_models1)$model,FUN=Anova), function(x) data.frame(x)[1,3:4]))
sel_models1_anova$sig<-ifelse(sel_models1_anova$Pr..F.<0.05,"*","")
kable(sel_models1_coefs)  #FFD * in all years but 1995,2009,2013,2015,2017
kable(sel_models1_rsq)
kable(sel_models1_anova)
# Chunk 6: Selection models with FFD & n_fl
sel_models2<-as.list(data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .)) )
sel_models2<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .))
sel_models2_coefs<-data.frame(sel_models2 %>% tidy(model))
sel_models2_coefs$sig<-ifelse(sel_models2_coefs$p.value<0.05,"*","")
sel_models2_rsq<-data.frame(sel_models2 %>% glance(model))[1:3]
sel_models2_anova<-cbind(
year=c("1987","1987","1988","1988","1989","1989","1990","1990","1991","1991","1992","1992","1993","1993",
"1994","1994","1995","1995","1996","1996","2006","2006","2007","2007","2008","2008","2009","2009",
"2010","2010","2011","2011","2012","2012","2013","2013","2014","2014","2015","2015","2016","2016",
"2017","2017"),
variable=rep(c("FFD_std","n_fl_std"),22),
ldply(lapply(as.list(sel_models2)$model,FUN=Anova), function(x) data.frame(x)[1:2,3:4]))
sel_models2_anova$sig<-ifelse(sel_models2_anova$Pr..F.<0.05,"*","")
kable(sel_models2_coefs)  #FFD * in 1991,1992,1993,2007,2010,2012,2014
kable(sel_models2_rsq)
kable(sel_models2_anova)
sel_grads_FFD<-subset(sel_models2_coefs,term=="FFD_std")[c(1,3,7)]
sel_grads_FFD #These are the per-year selection gradients for FFD
# Chunk 7: Non-linear selection
sel_models3<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+I(FFD_std^2)+n_fl_std+I(n_fl_std^2)+FFD_std:n_fl_std
, data = .))
sel_models3_coefs<-data.frame(sel_models3 %>% tidy(model))
sel_models3_coefs$sig<-ifelse(sel_models3_coefs$p.value<0.05,"*","")
sel_models3_rsq<-data.frame(sel_models3 %>% glance(model))[1:3]
sel_models3_anova<-cbind(
year=c("1987","1987","1987","1987","1987","1988","1988","1988","1988","1988",
"1989","1989","1989","1989","1989","1990","1990","1990","1990","1990",
"1991","1991","1991","1991","1991","1992","1992","1992","1992","1992",
"1993","1993","1993","1993","1993","1994","1994","1994","1994","1994",
"1995","1995","1995","1995","1995","1996","1996","1996","1996","1996",
"2006","2006","2006","2006","2006","2007","2007","2007","2007","2007",
"2008","2008","2008","2008","2008","2009","2009","2009","2009","2009",
"2010","2010","2010","2010","2010","2011","2011","2011","2011","2011",
"2012","2012","2012","2012","2012","2013","2013","2013","2013","2013",
"2014","2014","2014","2014","2014","2015","2015","2015","2015","2015",
"2016","2016","2016","2016","2016","2017","2017","2017","2017","2017"),
variable=rep(c("FFD_std","I(FFD_std^2)","n_fl_std","I(n_fl_std^2)","FFD_std:n_fl_std"),22),
ldply(lapply(as.list(sel_models3)$model,FUN=Anova), function(x) data.frame(x)[1:5,3:4]))
sel_models3_anova$sig<-ifelse(sel_models3_anova$Pr..F.<0.05,"*","")
kable(sel_models3_coefs)
#Correlational selection in 1988, 2016
#Quadratic selection on n_fl in 1990, 2006, 2015 and on FFD in 2015
kable(sel_models3_rsq)
kable(sel_models3_anova)
ggplot(sel_grads_FFD,aes(estimate,year,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("Not significant", "Significant"), values = c("blue", "red"))+
geom_vline(xintercept=0)+ggtitle("Selection gradients for each year")+theme(legend.position="top")
sel_grads_FFD$signif<-as.factor(with(sel_grads_FFD,ifelse(sig=="*","1","0")))
sel_grads_FFD$sig<-NULL
names(sel_grads_FFD)<-c("year","selgradFFD","sig_selgradFFD")
data_sel_agg<-merge(mean_weather5,sel_grads_FFD)
#Fit univariate linear models of selgradFFD against each predictor
models_selgrads<-lapply(names(data_sel_agg)[c(3:228)], function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))
})
#Build a table with estimate, p and r square for all fitted models
models_selgrads<-cbind(names(data_sel_agg)[c(3:228)],
ldply(models_selgrads, function(x) coef(x)[2]),
ldply(models_selgrads, function(x) coef(x)[8]),
ldply(models_selgrads, function(x) x$adj.r.square)
)
names(models_selgrads)<-c("variable","estimate","p","adj.rsquare")
models_selgrads$sig<-ifelse(models_selgrads$p<0.05,"*","") # *=p<0.05
#Order models by R square
kable(arrange(models_selgrads,desc(adj.rsquare)))
ggplot(data_sel_agg,aes(min_7,selgradFFD))+geom_point()
ggplot(data_sel_agg,aes(min_7,selgradFFD))+geom_point()+geom_smooth()
ggplot(data_sel_agg,aes(min_7,selgradFFD))+geom_point()+geom_smooth(method="lm")
#Only precipitation in March and several temperature variables in July are significant
kable(arrange(subset(models_selgradssig=="*"),desc(adj.rsquare)))
#Only precipitation in March and several temperature variables in July are significant
kable(arrange(subset(models_selgrads,sig=="*"),desc(adj.rsquare)))
ggplot(data_sel_agg,aes(GDD10_7,selgradFFD))+geom_point()+geom_smooth(method="lm")
ggplot(data_sel_agg,aes(min_7,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Average daily minimum temperature in July")+ylab("Selection gradient for FFD")
names(data_sel_agg)
#Order models by R square
kable(arrange(models_selgrads,desc(adj.rsquare)))
#Only precipitation in March and several temperature variables in July are significant
kable(arrange(subset(models_selgrads,sig=="*"),desc(adj.rsquare)))
ggplot(data_sel_agg,aes(precipitation_3,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Sum of precipitation in March")+ylab("Selection gradient for FFD")
summary(lm(selgradFFD~min_7*precipitation_3,data=data_sel_agg))
summary(lm(selgradFFD~min_7+precipitation_3,data=data_sel_agg))
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3),data=data_sel_agg))
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(I(min_7^2)),data=data_sel_agg))
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(I(precipitation_3^2)),data=data_sel_agg))
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3),data=data_sel_agg))
#Model with the two best variables: precipitation in March and average daily minimum temp in July
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3),data=data_sel_agg)) #36% variance explained
#Model with the two best variables: precipitation in March and average daily minimum temp in July
summary(lm(selgradFFD~scale(min_7),data=data_sel_agg)) #36% variance explained
#Only precipitation in March and several temperature variables in July are significant
kable(arrange(subset(models_selgrads,sig=="*"),desc(adj.rsquare)))
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(GDD10_7),data=data_sel_agg)) #36% variance explained
vif(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(GDD10_7),data=data_sel_agg)) #36% variance explained
vif(lm(selgradFFD~scale(precipitation_3)+scale(GDD10_7),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~scale(precipitation_3)+scale(GDD10_7),data=data_sel_agg)) #36% variance explained
#Only precipitation in March and several temperature variables in July are significant
kable(arrange(subset(models_selgrads,sig=="*"),desc(adj.rsquare)))
summary(lm(selgradFFD~scale(precipitation_3)+scale(GDH3_7),data=data_sel_agg)) #36% variance explained
#Model with the two best variables: precipitation in March and average daily minimum temp in July
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~FFD,data=data_sel_agg)) #36% variance explained
data_sel_agg
with(sel_agg,plot(FFD~year))
with(data_sel_agg,plot(FFD~year))
data_sel_agg$year
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(FFD),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~scale(FFD),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~FFD,data=data_sel_agg)) #No effect of mean FFD
names(data_sel)
hist(data_sel$grazing)
aggregate(grazing~year,data_sel)
aggregate(grazing~year,data_sel,FUN=mean)
with(
aggregate(grazing~year,data_sel,FUN=mean),
plot(grazing~year))
data_sel_agg
data_sel_agg<-merge(data_sel_agg,aggregate(grazing~year,data_sel,FUN=mean))
data_sel_agg
#Added mean grazing per year
summary(lm(selgradFFD~grazing,data=data_sel_agg)) #No effect of mean FFD
ggplot(data_sel_agg,aes(grazing,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Mean grazing")+ylab("Selection gradient for FFD")
summary(lm(selgradFFD~grazing,data=subset(data_sel_agg,year<2017))) #p=0.0691
ggplot(subset(data_sel_agg,year<2017),aes(grazing,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Mean grazing")+ylab("Selection gradient for FFD")
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(grazing),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~scale(min_7)+scale(grazing),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~scale(precipitation_3)+scale(grazing),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(grazing),data=data_sel_agg)) #36% variance explained
vif(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(grazing),data=data_sel_agg)) #36% variance explained
summary(lm(grazing~min_7,data=data_sel_agg))
hist(data_sel_agg$grazing)
head(data_sel)
data_sel$prop_pred_seeds<-with(data_sel,(n_seeds-n_intact_seeds)/n_intact_seeds)
hist(data_sel$prop_pred_seeds)
data_sel$prop_pred_seeds<-with(data_sel,(n_seeds-n_intact_seeds))
hist(data_sel$prop_pred_seeds)
data_sel$prop_pred_seeds<-with(data_sel,((n_seeds-n_intact_seeds)/n_intact_seeds))
hist(data_sel$prop_pred_seeds)
data_sel$prop_pred_seeds<-(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_intact_seeds
hist(data_sel$prop_pred_seeds)
hist(data_sel$n_seeds)
(8.436-6.512592)/6.512592
data_sel$prop_pred_seeds<-(data_sel$n_seeds-data_sel$n_intact_seeds)
head(data_sel)
data_sel$prop_pred_seeds<-(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_intact_seeds
head(data_sel)
hist(data_sel$prop_pred_seeds)
subset(data_sel,data_sel$n_intact_seeds>100)
subset(data_sel,data_sel$n_intact_seeds>1)
subset(data_sel,data_sel$prop_pred_seeds>100)
subset(data_sel,data_sel$prop_pred_seeds>1)
data_sel$prop_pred_seeds<-(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_seeds
hist(data_sel$prop_pred_seeds)
subset(data_sel$prop_pred_seeds>1)
subset(data_sel,prop_pred_seeds>1)
head(data_sel)
data_sel$prop_pred_seeds<-with(data_sel,ifelse(n_seeds==n_intact_seeds,0,(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_seeds))
hist(data_sel$prop_pred_seeds)
head(data_sel)
data_sel$prop_pred_seeds
is.na(data_sel$prop_pred_seeds)
nrow(is.na(data_sel$prop_pred_seeds)==TRUE)
is.na(data_sel$prop_pred_seeds)==TRUE
length(is.na(data_sel$prop_pred_seeds)==TRUE)
subset(data_sel,is.na(prop_pred_seeds))
plot(data_sel$prop_pred_seeds)
data_sel$prop_pred_seeds<-with(data_sel,ifelse(n_seeds==n_intact_seeds,0,(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_seeds))
data_sel$prop_pred_seeds<-with(data_sel,
ifelse(n_seeds==n_intact_seeds,0,
(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_seeds))
data_sel$prop_pred_seeds<-with(data_sel,
ifelse(n_seeds==n_intact_seeds,0,
(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_seeds))
aggregate(prop_pred_seeds~year,data_sel,FUN=mean)
with(aggregate(prop_pred_seeds~year,data_sel,FUN=mean),plot(prop_pred_seeds~year))
data_sel_agg
data_sel_agg<-merge(data_sel_agg,aggregate(prop_pred_seeds~year,data_sel,FUN=mean))
data_sel_agg
hist(data_sel_agg$prop_pred_seeds)
#Added mean seed predation (proportion of predated seeds) per year
summary(lm(selgradFFD~prop_pred_seeds,data=data_sel_agg)) #p=0.0691
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+scale(prop_pred_seeds),data=data_sel_agg)) #36% variance explained
summary(lm(selgradFFD~scale(min_7)+scale(precipitation_3)+prop_pred_seeds,data=data_sel_agg)) #36% variance explained
summary(lm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg)) #36% variance explained
summary(lm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg)) #35% variance explained
summary(lm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg)) #35% variance explained
plot(lm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg)) #35% variance explained
summary(glm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg,
family="binomial")) #35% variance explained
NagelkerkeR2(glm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg,
family="binomial"))
library(fmsb)
NagelkerkeR2(glm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg,
family="binomial"))
data_sel$n_pred_seeds<-with(data_sel,n_seeds-n_intact_seeds)
hist(data_sel$n_pred_seeds)
subset(data_sel,n_pred_seeds>40)
aggregate(n_pred_seeds~year,data_sel,FUN=mean)
with(aggregate(n_pred_seeds~year,data_sel,FUN=mean),plot(n_pred_seeds~year)
)
data_sel_agg
data_sel_agg<-merge(data_sel_agg,aggregate(n_pred_seeds~year,data_sel,FUN=mean))
data_sel_agg
#Added mean seed predation (proportion of predated seeds) per year
summary(lm(selgradFFD~prop_pred_seeds,data=data_sel_agg)) #NS
summary(lm(selgradFFD~n_pred_seeds,data=data_sel_agg)) #NS
data_sel_agg<-merge(data_sel_agg,aggregate(n_seeds~year,data_sel,FUN=mean))
data_sel_agg
summary(glm(cbind(n_pred_seeds/n_seeds)~scale(min_7)+scale(precipitation_3),data=data_sel_agg,
family="binomial"))
summary(glm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg,
family="binomial"))
summary(glm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg,
family="binomial"))
NagelkerkeR2(glm(prop_pred_seeds~scale(min_7)+scale(precipitation_3),data=data_sel_agg,
family="binomial"))
hist(data_sel_agg$grazing)
summary(lm(grazing~scale(min_7)+scale(precipitation_3),data=data_sel_agg)) #35% variance explained
