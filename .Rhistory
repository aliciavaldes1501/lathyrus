year=c("1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","2006",
"2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017"),
variable=rep(c("FFD_std"),22),
plyr::ldply(lapply(as.list(sel_models1)$model,FUN=Anova), function(x) data.frame(x)[1,3:4]))
sel_models1_anova$sig<-ifelse(sel_models1_anova$Pr..F.<0.05,"*","")
kable(sel_models1_coefs)  #Selection gradients
#FFD * (selection for early flowering) in all years but 1995,2009,2013,2015,2017
kable(sel_models1_rsq) #R squares
kable(sel_models1_anova) #Anova results
ggplot(data_sel,aes(FFD_std,n_intact_seeds_rel,colour=year))+
geom_smooth(method="lm",se=F,size=0.6)+geom_point(size=0.5)+
xlab("Standardized FFD")+ylab("Relative number of intact seeds")
ggplot(data_sel,aes(FFD_std,n_intact_seeds_rel,colour=year))+
geom_smooth(method="lm",se=F,size=0.6)+
xlab("Standardized FFD")+ylab("Relative number of intact seeds")
sel_models2<-as.list(data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .)) )
sel_models2<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .))
sel_models2_coefs<-data.frame(sel_models2 %>% tidy(model))
sel_models2_coefs$sig<-ifelse(sel_models2_coefs$p.value<0.05,"*","")
sel_models2_rsq<-data.frame(sel_models2 %>% glance(model))[1:3]
sel_models2_anova<-cbind(
year=c("1987","1987","1988","1988","1989","1989","1990","1990","1991","1991",
"1992","1992","1993","1993","1994","1994","1995","1995","1996","1996","2006",
"2006","2007","2007","2008","2008","2009","2009","2010","2010","2011","2011",
"2012","2012","2013","2013","2014","2014","2015","2015","2016","2016",
"2017","2017"),variable=rep(c("FFD_std","n_fl_std"),22),
plyr::ldply(lapply(as.list(sel_models2)$model,FUN=Anova),
function(x) data.frame(x)[1:2,3:4]))
sel_models2_anova$sig<-ifelse(sel_models2_anova$Pr..F.<0.05,"*","")
kable(sel_models2_coefs) #Selection gradients
#FFD * (selection for early flowering) in 1991,1992,1993,2007,2010,2012,2014
kable(sel_models2_rsq) #R squares
kable(sel_models2_anova) #Anova results
sel_grads_FFD<-subset(sel_models2_coefs,term=="FFD_std")[c(1,3,7)]
sel_grads_FFD
#These are the per-year selection gradients for FFD, to be used in further analyses
sel_models3<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+I(FFD_std^2)+n_fl_std+I(n_fl_std^2)+
FFD_std:n_fl_std, data = .))
sel_models3_coefs<-data.frame(sel_models3 %>% tidy(model))
sel_models3_coefs$sig<-ifelse(sel_models3_coefs$p.value<0.05,"*","")
sel_models3_rsq<-data.frame(sel_models3 %>% glance(model))[1:3]
sel_models3_anova<-cbind(
year=c("1987","1987","1987","1987","1987","1988","1988","1988","1988","1988",
"1989","1989","1989","1989","1989","1990","1990","1990","1990","1990",
"1991","1991","1991","1991","1991","1992","1992","1992","1992","1992",
"1993","1993","1993","1993","1993","1994","1994","1994","1994","1994",
"1995","1995","1995","1995","1995","1996","1996","1996","1996","1996",
"2006","2006","2006","2006","2006","2007","2007","2007","2007","2007",
"2008","2008","2008","2008","2008","2009","2009","2009","2009","2009",
"2010","2010","2010","2010","2010","2011","2011","2011","2011","2011",
"2012","2012","2012","2012","2012","2013","2013","2013","2013","2013",
"2014","2014","2014","2014","2014","2015","2015","2015","2015","2015",
"2016","2016","2016","2016","2016","2017","2017","2017","2017","2017"),
variable=rep(c("FFD_std","I(FFD_std^2)","n_fl_std","I(n_fl_std^2)","FFD_std:n_fl_std"),22),
plyr::ldply(lapply(as.list(sel_models3)$model,FUN=Anova), function(x) data.frame(x)[1:5,3:4]))
sel_models3_anova$sig<-ifelse(sel_models3_anova$Pr..F.<0.05,"*","")
kable(sel_models3_coefs) #Selection gradients
#Correlational selection in 1988, 2016
#Quadratic selection on n_fl in 1990, 2006, 2015 and on FFD in 2015
kable(sel_models3_rsq) #R squares
kable(sel_models3_anova) #Anova results
ggplot(sel_grads_FFD,aes(estimate,year,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("Not significant", "Significant"), values = c("blue", "red"))+
geom_vline(xintercept=0)+theme(legend.position="top")
sel_grads_FFD$signif<-as.factor(with(sel_grads_FFD,ifelse(sig=="*","1","0")))
sel_grads_FFD$sig<-NULL
names(sel_grads_FFD)<-c("year","selgradFFD","sig_selgradFFD")
data_sel_agg<-merge(mean_weather5,sel_grads_FFD)
#Fit univariate linear models of selgradFFD against each predictor (climatic variables)
varlist<-names(data_sel_agg)[c(8:10,20:22,32:34,42:46,56:58,68:70,80:82,
92:94,104:106,116:118,128:130,134,138:142,146:217,217,223:232)]
models_selgrads<-lapply(varlist, function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_selgrads<-cbind(varlist,
plyr::ldply(models_selgrads, function(x) coef(x)[2]),
plyr::ldply(models_selgrads, function(x) coef(x)[8]),
plyr::ldply(models_selgrads, function(x) x$adj.r.square))
names(models_selgrads)<-c("variable","estimate","p","adj.rsquare")
models_selgrads$sig<-ifelse(models_selgrads$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_selgrads,sig=="*"),desc(adj.rsquare)))
ggplot(data_sel_agg,aes(precipitation_3,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Sum of precipitation in March")+ylab("Selection gradient for FFD")
kable(prettify(summary(lm(selgradFFD~FFD_mean,data=data_sel_agg)))) #No effect of FFD_mean
kable(prettify(summary(lm(selgradFFD~FFD_var,data=data_sel_agg)))) #No effect of FFD_var
kable(prettify(summary(lm(selgradFFD~FFD_dur,data=data_sel_agg)))) #No effect of FFD_dur
kable(prettify(summary(lm(selgradFFD~FFD_skew,data=data_sel_agg)))) #No effect of FFD_skew
kable(prettify(summary(lm(selgradFFD~FFD_kurt,data=data_sel_agg)))) #No effect of FFD_kurt
data_sel_agg<-merge(data_sel_agg,aggregate(grazing~year,data_sel,FUN=mean))
#Added mean grazing per year
kable(prettify(summary(lm(selgradFFD~grazing,data=data_sel_agg))))
#p=0.0691
kable(prettify(summary(lm(selgradFFD~grazing,data=subset(data_sel_agg,year<2017)))))
#Removing 2017, worse p=0.0948
#No effect of grazing (or very low effect?)
grid.arrange(
ggplot(data_sel_agg,aes(grazing,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Mean grazing")+ylab("Selection gradient for FFD")+ggtitle("With all years"),
ggplot(subset(data_sel_agg,year<2017),aes(grazing,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Mean grazing")+ylab("Selection gradient for FFD")+ggtitle("Without 2017"),ncol=2)
data_sel$n_pred_seeds<-with(data_sel,n_seeds-n_intact_seeds)
data_sel$prop_pred_seeds<-with(data_sel,
ifelse(n_seeds==n_intact_seeds,0,
(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_seeds))
data_sel_agg<-merge(data_sel_agg,aggregate(prop_pred_seeds~year,data_sel,FUN=mean))
data_sel_agg<-merge(data_sel_agg,aggregate(n_pred_seeds~year,data_sel,FUN=mean))
data_sel_agg<-merge(data_sel_agg,aggregate(n_seeds~year,data_sel,FUN=mean))
#Added mean seed predation (proportion and n of predated seeds) per year
kable(prettify(summary(lm(selgradFFD~prop_pred_seeds,data=data_sel_agg)))) #NS
kable(prettify(summary(lm(selgradFFD~n_pred_seeds,data=data_sel_agg)))) #NS
data_sel$fr_set<-with(data_sel,n_fr/n_fl)           #Calculate fruit set
data_sel$seed_set<-with(data_sel,n_seeds/n_ovules)  #Calculate seed set
nrow(subset(data_sel,n_fr>n_fl)) #0 cases where n_fruits>n_flowers
par(mfrow=c(1,2))
hist(data_sel$fr_set,main=NULL)
hist(data_sel$seed_set,main=NULL)
data_sel_agg<-merge(data_sel_agg,aggregate(fr_set~year,data_sel,FUN=mean))
data_sel_agg<-merge(data_sel_agg,aggregate(seed_set~year,data_sel,FUN=mean))
kable(prettify(summary(lm(selgradFFD~fr_set,data=data_sel_agg)))) #NS
kable(prettify(summary(lm(selgradFFD~seed_set,data=data_sel_agg)))) #NS
summary(lm(selgradFFD~grazing+prop_pred_seeds+fr_set+seed_set,data=data_sel_agg)) #
grid.arrange(
ggplot(data_sel_agg,aes(year,grazing))+geom_point(),
ggplot(data_sel_agg,aes(year,prop_pred_seeds))+geom_point(),
ncol=2)
#Fit univariate linear models of grazing against each predictor (climatic variables)
models_grazing<-lapply(varlist, function(x) {
summary(lm(substitute(log(grazing) ~ scale(i), list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_grazing<-cbind(varlist,
plyr::ldply(models_grazing, function(x) coef(x)[2]),
plyr::ldply(models_grazing, function(x) coef(x)[8]),
plyr::ldply(models_grazing, function(x) x$adj.r.squared)
)
names(models_grazing)<-c("variable","estimate","p","rsquare")
models_grazing$sig<-ifelse(models_grazing$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_grazing,sig=="*"),desc(rsquare)))
summary(lm(log(grazing)~scale(precipitation_3)+scale(GDD10_45),data=data_sel_agg))
kable(prettify(summary(lm(log(grazing) ~ FFD_mean,data=data_sel_agg))))
#No effect of FFD_mean
kable(prettify(summary(lm(log(grazing) ~ FFD_mean,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, No effect of FFD_mean
kable(prettify(summary(lm(log(grazing) ~ FFD_var,data=data_sel_agg))))
#FFD_var*
summary(lm(log(grazing) ~ FFD_var,data=data_sel_agg))$adj.r.squared
kable(prettify(summary(lm(log(grazing) ~ FFD_var,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, FFD_var*
summary(lm(log(grazing) ~ FFD_var,data=subset(data_sel_agg,!year=="2017")))$adj.r.squared
kable(prettify(summary(lm(log(grazing) ~ FFD_dur,data=data_sel_agg)))) #FFD_dur*
kable(prettify(summary(lm(log(grazing) ~ FFD_dur,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, FFD_dur*
kable(prettify(summary(lm(log(grazing) ~ FFD_skew,data=data_sel_agg))))
#No effect of FFD_skew
kable(prettify(summary(lm(log(grazing) ~ FFD_skew,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, No effect of FFD_skew
kable(prettify(summary(lm(log(grazing) ~ FFD_kurt,data=data_sel_agg))))
#No effect of FFD_kurt
kable(prettify(summary(lm(log(grazing) ~ FFD_kurt,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, No effect of FFD_kurt
grid.arrange(
ggplot(data_sel_agg,aes(x=precipitation_3,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Sum of precipitation in March")+ylab("Grazing (log)"),
ggplot(data_sel_agg,aes(x=GDD10_45,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Sum of GDD10 in April and May")+ylab("Grazing (log)"),
ggplot(data_sel_agg,aes(x=FFD_var,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Variance of FFD")+ylab("Grazing (log)"),
ggplot(data_sel_agg,aes(x=FFD_dur,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Range of FFD")+ylab("Grazing (log)"),
ncol=2)
#Fit univariate linear models of grazing against each predictor (climatic variables)
models_spred<-lapply(varlist, function(x) {
summary(lm(substitute(asin(sqrt(prop_pred_seeds)) ~ scale(i),
list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_spred<-cbind(varlist,
plyr::ldply(models_spred, function(x) coef(x)[2]),
plyr::ldply(models_spred, function(x) coef(x)[8]),
plyr::ldply(models_spred, function(x) x$adj.r.squared)
)
names(models_spred)<-c("variable","estimate","p","rsquare")
models_spred$sig<-ifelse(models_spred$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_spred,sig=="*"),desc(rsquare)))
summary(lm(asin(sqrt(prop_pred_seeds))~scale(max456),data=data_sel_agg))
ggplot(data_sel_agg,aes(x=max456,y=asin(sqrt(prop_pred_seeds))))+geom_point()+
geom_smooth(method="lm")+xlab("Average maximum temperature April-June")+
ylab("Proportion of predated seeds \n (arcsin-transformed)")
kable(prettify(summary(lm(sqrt(prop_pred_seeds) ~ FFD_mean,data=data_sel_agg)))) #No effect of FFD_mean
load(file = "C:/Users/User/Dropbox/SU/Projects/lathyrus/code/image1.RData")
library(dplyr)
library(broom)
library(knitr)
library(car)
library(ggplot2)
library(fmsb)
library(gridExtra)
library(papeR)
data_sel<-subset(alldata_weather_subs,!is.na(n_fl)&!is.na(FFD))
#Select data where both FFD and n_fl are available
nrow(subset(data_sel,is.na(n_intact_seeds))) #No NAs for seed data
par(mfrow=c(1,3))
with(data_sel,hist(FFD))
with(data_sel,hist(n_fl))
with(data_sel,hist(n_intact_seeds))
data_sel<-data.frame(
data_sel %>%
group_by(year) %>%
mutate(n_intact_seeds_rel=n_intact_seeds/mean(n_intact_seeds)) %>% #Relative fitness
mutate(FFD_std=(FFD-mean(FFD))/sd(FFD)) %>%                        #Standardized FFD
mutate(n_fl_std=(n_fl-mean(n_fl))/sd(n_fl)))                       #Standardized n_fl
Anova(lm(n_intact_seeds_rel ~ FFD_std+FFD_std:year, data = data_sel),type="II")
#Not sure about type - II for interactions?
Anova(lm(n_intact_seeds_rel ~ FFD_std+FFD_std:year+n_fl_std+n_fl_std:year,
data = data_sel),type="II")
#Selection for early flowering differs among years when considering only FFD, but
#does not differ among years when including also number of flowers as a covariate
Anova(update(lm(n_intact_seeds_rel ~ (FFD_std+I(FFD_std^2))*year,
data = data_sel),.~.-year),type="II")
Anova(update(lm(n_intact_seeds_rel~(FFD_std+I(FFD_std^2)+n_fl_std+I(n_fl_std^2)+
FFD_std:n_fl_std)*year, data = data_sel),.~.-year),type="II")
#No evidence of non-linear selection for FFD (but quadratic selection for n_fl)
sel_models1<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std, data = .))
sel_models1_coefs<-data.frame(sel_models1 %>% tidy(model))
sel_models1_coefs$sig<-ifelse(sel_models1_coefs$p.value<0.05,"*","")
sel_models1_rsq<-data.frame(sel_models1 %>% glance(model))[1:3]
sel_models1_anova<-cbind(
year=c("1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","2006",
"2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017"),
variable=rep(c("FFD_std"),22),
plyr::ldply(lapply(as.list(sel_models1)$model,FUN=Anova), function(x) data.frame(x)[1,3:4]))
sel_models1_anova$sig<-ifelse(sel_models1_anova$Pr..F.<0.05,"*","")
kable(sel_models1_coefs)  #Selection gradients
#FFD * (selection for early flowering) in all years but 1995,2009,2013,2015,2017
kable(sel_models1_rsq) #R squares
kable(sel_models1_anova) #Anova results
ggplot(data_sel,aes(FFD_std,n_intact_seeds_rel,colour=year))+
geom_smooth(method="lm",se=F,size=0.6)+geom_point(size=0.5)+
xlab("Standardized FFD")+ylab("Relative number of intact seeds")
ggplot(data_sel,aes(FFD_std,n_intact_seeds_rel,colour=year))+
geom_smooth(method="lm",se=F,size=0.6)+
xlab("Standardized FFD")+ylab("Relative number of intact seeds")
sel_models2<-as.list(data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .)) )
sel_models2<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+n_fl_std, data = .))
sel_models2_coefs<-data.frame(sel_models2 %>% tidy(model))
sel_models2_coefs$sig<-ifelse(sel_models2_coefs$p.value<0.05,"*","")
sel_models2_rsq<-data.frame(sel_models2 %>% glance(model))[1:3]
sel_models2_anova<-cbind(
year=c("1987","1987","1988","1988","1989","1989","1990","1990","1991","1991",
"1992","1992","1993","1993","1994","1994","1995","1995","1996","1996","2006",
"2006","2007","2007","2008","2008","2009","2009","2010","2010","2011","2011",
"2012","2012","2013","2013","2014","2014","2015","2015","2016","2016",
"2017","2017"),variable=rep(c("FFD_std","n_fl_std"),22),
plyr::ldply(lapply(as.list(sel_models2)$model,FUN=Anova),
function(x) data.frame(x)[1:2,3:4]))
sel_models2_anova$sig<-ifelse(sel_models2_anova$Pr..F.<0.05,"*","")
kable(sel_models2_coefs) #Selection gradients
#FFD * (selection for early flowering) in 1991,1992,1993,2007,2010,2012,2014
kable(sel_models2_rsq) #R squares
kable(sel_models2_anova) #Anova results
sel_grads_FFD<-subset(sel_models2_coefs,term=="FFD_std")[c(1,3,7)]
sel_grads_FFD
#These are the per-year selection gradients for FFD, to be used in further analyses
sel_models3<-data_sel %>%
group_by(year) %>%
do(model = lm(n_intact_seeds_rel ~ FFD_std+I(FFD_std^2)+n_fl_std+I(n_fl_std^2)+
FFD_std:n_fl_std, data = .))
sel_models3_coefs<-data.frame(sel_models3 %>% tidy(model))
sel_models3_coefs$sig<-ifelse(sel_models3_coefs$p.value<0.05,"*","")
sel_models3_rsq<-data.frame(sel_models3 %>% glance(model))[1:3]
sel_models3_anova<-cbind(
year=c("1987","1987","1987","1987","1987","1988","1988","1988","1988","1988",
"1989","1989","1989","1989","1989","1990","1990","1990","1990","1990",
"1991","1991","1991","1991","1991","1992","1992","1992","1992","1992",
"1993","1993","1993","1993","1993","1994","1994","1994","1994","1994",
"1995","1995","1995","1995","1995","1996","1996","1996","1996","1996",
"2006","2006","2006","2006","2006","2007","2007","2007","2007","2007",
"2008","2008","2008","2008","2008","2009","2009","2009","2009","2009",
"2010","2010","2010","2010","2010","2011","2011","2011","2011","2011",
"2012","2012","2012","2012","2012","2013","2013","2013","2013","2013",
"2014","2014","2014","2014","2014","2015","2015","2015","2015","2015",
"2016","2016","2016","2016","2016","2017","2017","2017","2017","2017"),
variable=rep(c("FFD_std","I(FFD_std^2)","n_fl_std","I(n_fl_std^2)","FFD_std:n_fl_std"),22),
plyr::ldply(lapply(as.list(sel_models3)$model,FUN=Anova), function(x) data.frame(x)[1:5,3:4]))
sel_models3_anova$sig<-ifelse(sel_models3_anova$Pr..F.<0.05,"*","")
kable(sel_models3_coefs) #Selection gradients
#Correlational selection in 1988, 2016
#Quadratic selection on n_fl in 1990, 2006, 2015 and on FFD in 2015
kable(sel_models3_rsq) #R squares
kable(sel_models3_anova) #Anova results
ggplot(sel_grads_FFD,aes(estimate,year,colour=sig))+geom_point()+ylab("Selection gradient")+
scale_color_manual(labels = c("Not significant", "Significant"), values = c("blue", "red"))+
geom_vline(xintercept=0)+theme(legend.position="top")
sel_grads_FFD$signif<-as.factor(with(sel_grads_FFD,ifelse(sig=="*","1","0")))
sel_grads_FFD$sig<-NULL
names(sel_grads_FFD)<-c("year","selgradFFD","sig_selgradFFD")
data_sel_agg<-merge(mean_weather5,sel_grads_FFD)
#Fit univariate linear models of selgradFFD against each predictor (climatic variables)
varlist<-names(data_sel_agg)[c(8:10,20:22,32:34,42:46,56:58,68:70,80:82,
92:94,104:106,116:118,128:130,134,138:142,146:217,217,223:232)]
models_selgrads<-lapply(varlist, function(x) {
summary(lm(substitute(selgradFFD ~ scale(i), list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_selgrads<-cbind(varlist,
plyr::ldply(models_selgrads, function(x) coef(x)[2]),
plyr::ldply(models_selgrads, function(x) coef(x)[8]),
plyr::ldply(models_selgrads, function(x) x$adj.r.square))
names(models_selgrads)<-c("variable","estimate","p","adj.rsquare")
models_selgrads$sig<-ifelse(models_selgrads$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_selgrads,sig=="*"),desc(adj.rsquare)))
ggplot(data_sel_agg,aes(precipitation_3,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Sum of precipitation in March")+ylab("Selection gradient for FFD")
kable(prettify(summary(lm(selgradFFD~FFD_mean,data=data_sel_agg)))) #No effect of FFD_mean
kable(prettify(summary(lm(selgradFFD~FFD_var,data=data_sel_agg)))) #No effect of FFD_var
kable(prettify(summary(lm(selgradFFD~FFD_dur,data=data_sel_agg)))) #No effect of FFD_dur
kable(prettify(summary(lm(selgradFFD~FFD_skew,data=data_sel_agg)))) #No effect of FFD_skew
kable(prettify(summary(lm(selgradFFD~FFD_kurt,data=data_sel_agg)))) #No effect of FFD_kurt
data_sel_agg<-merge(data_sel_agg,aggregate(grazing~year,data_sel,FUN=mean))
#Added mean grazing per year
kable(prettify(summary(lm(selgradFFD~grazing,data=data_sel_agg))))
#p=0.0691
kable(prettify(summary(lm(selgradFFD~grazing,data=subset(data_sel_agg,year<2017)))))
#Removing 2017, worse p=0.0948
#No effect of grazing (or very low effect?)
grid.arrange(
ggplot(data_sel_agg,aes(grazing,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Mean grazing")+ylab("Selection gradient for FFD")+ggtitle("With all years"),
ggplot(subset(data_sel_agg,year<2017),aes(grazing,selgradFFD))+geom_point()+geom_smooth(method="lm")+
xlab("Mean grazing")+ylab("Selection gradient for FFD")+ggtitle("Without 2017"),ncol=2)
data_sel$n_pred_seeds<-with(data_sel,n_seeds-n_intact_seeds)
data_sel$prop_pred_seeds<-with(data_sel,
ifelse(n_seeds==n_intact_seeds,0,
(data_sel$n_seeds-data_sel$n_intact_seeds)/data_sel$n_seeds))
data_sel_agg<-merge(data_sel_agg,aggregate(prop_pred_seeds~year,data_sel,FUN=mean))
data_sel_agg<-merge(data_sel_agg,aggregate(n_pred_seeds~year,data_sel,FUN=mean))
data_sel_agg<-merge(data_sel_agg,aggregate(n_seeds~year,data_sel,FUN=mean))
#Added mean seed predation (proportion and n of predated seeds) per year
kable(prettify(summary(lm(selgradFFD~prop_pred_seeds,data=data_sel_agg)))) #NS
kable(prettify(summary(lm(selgradFFD~n_pred_seeds,data=data_sel_agg)))) #NS
data_sel$fr_set<-with(data_sel,n_fr/n_fl)           #Calculate fruit set
data_sel$seed_set<-with(data_sel,n_seeds/n_ovules)  #Calculate seed set
nrow(subset(data_sel,n_fr>n_fl)) #0 cases where n_fruits>n_flowers
par(mfrow=c(1,2))
hist(data_sel$fr_set,main=NULL)
hist(data_sel$seed_set,main=NULL)
data_sel_agg<-merge(data_sel_agg,aggregate(fr_set~year,data_sel,FUN=mean))
data_sel_agg<-merge(data_sel_agg,aggregate(seed_set~year,data_sel,FUN=mean))
kable(prettify(summary(lm(selgradFFD~fr_set,data=data_sel_agg)))) #NS
kable(prettify(summary(lm(selgradFFD~seed_set,data=data_sel_agg)))) #NS
summary(lm(selgradFFD~grazing+prop_pred_seeds+fr_set+seed_set,data=data_sel_agg)) #
grid.arrange(
ggplot(data_sel_agg,aes(year,grazing))+geom_point(),
ggplot(data_sel_agg,aes(year,prop_pred_seeds))+geom_point(),
ncol=2)
#Fit univariate linear models of grazing against each predictor (climatic variables)
models_grazing<-lapply(varlist, function(x) {
summary(lm(substitute(log(grazing) ~ scale(i), list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_grazing<-cbind(varlist,
plyr::ldply(models_grazing, function(x) coef(x)[2]),
plyr::ldply(models_grazing, function(x) coef(x)[8]),
plyr::ldply(models_grazing, function(x) x$adj.r.squared)
)
names(models_grazing)<-c("variable","estimate","p","rsquare")
models_grazing$sig<-ifelse(models_grazing$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_grazing,sig=="*"),desc(rsquare)))
summary(lm(log(grazing)~scale(precipitation_3)+scale(GDD10_45),data=data_sel_agg))
kable(prettify(summary(lm(log(grazing) ~ FFD_mean,data=data_sel_agg))))
#No effect of FFD_mean
kable(prettify(summary(lm(log(grazing) ~ FFD_mean,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, No effect of FFD_mean
kable(prettify(summary(lm(log(grazing) ~ FFD_var,data=data_sel_agg))))
#FFD_var*
summary(lm(log(grazing) ~ FFD_var,data=data_sel_agg))$adj.r.squared
kable(prettify(summary(lm(log(grazing) ~ FFD_var,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, FFD_var*
summary(lm(log(grazing) ~ FFD_var,data=subset(data_sel_agg,!year=="2017")))$adj.r.squared
kable(prettify(summary(lm(log(grazing) ~ FFD_dur,data=data_sel_agg)))) #FFD_dur*
kable(prettify(summary(lm(log(grazing) ~ FFD_dur,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, FFD_dur*
kable(prettify(summary(lm(log(grazing) ~ FFD_skew,data=data_sel_agg))))
#No effect of FFD_skew
kable(prettify(summary(lm(log(grazing) ~ FFD_skew,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, No effect of FFD_skew
kable(prettify(summary(lm(log(grazing) ~ FFD_kurt,data=data_sel_agg))))
#No effect of FFD_kurt
kable(prettify(summary(lm(log(grazing) ~ FFD_kurt,data=subset(data_sel_agg,!year=="2017")))))
#Removing 2017, No effect of FFD_kurt
grid.arrange(
ggplot(data_sel_agg,aes(x=precipitation_3,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Sum of precipitation in March")+ylab("Grazing (log)"),
ggplot(data_sel_agg,aes(x=GDD10_45,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Sum of GDD10 in April and May")+ylab("Grazing (log)"),
ggplot(data_sel_agg,aes(x=FFD_var,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Variance of FFD")+ylab("Grazing (log)"),
ggplot(data_sel_agg,aes(x=FFD_dur,y=log(grazing)))+geom_point()+geom_smooth(method="lm")+
xlab("Range of FFD")+ylab("Grazing (log)"),
ncol=2)
#Fit univariate linear models of grazing against each predictor (climatic variables)
models_spred<-lapply(varlist, function(x) {
summary(lm(substitute(asin(sqrt(prop_pred_seeds)) ~ scale(i),
list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_spred<-cbind(varlist,
plyr::ldply(models_spred, function(x) coef(x)[2]),
plyr::ldply(models_spred, function(x) coef(x)[8]),
plyr::ldply(models_spred, function(x) x$adj.r.squared)
)
names(models_spred)<-c("variable","estimate","p","rsquare")
models_spred$sig<-ifelse(models_spred$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_spred,sig=="*"),desc(rsquare)))
summary(lm(asin(sqrt(prop_pred_seeds))~scale(max456),data=data_sel_agg))
ggplot(data_sel_agg,aes(x=max456,y=asin(sqrt(prop_pred_seeds))))+geom_point()+
geom_smooth(method="lm")+xlab("Average maximum temperature April-June")+
ylab("Proportion of predated seeds \n (arcsin-transformed)")
kable(prettify(summary(lm(sqrt(prop_pred_seeds) ~ FFD_mean,data=data_sel_agg)))) #No effect of FFD_mean
kable(prettify(summary(lm(sqrt(prop_pred_seeds) ~ FFD_var,data=data_sel_agg)))) #No effect of FFD_var
kable(prettify(summary(lm(sqrt(prop_pred_seeds) ~ FFD_dur,data=data_sel_agg)))) #No effect of FFD_dur
kable(prettify(summary(lm(sqrt(prop_pred_seeds) ~ FFD_skew,data=data_sel_agg)))) #No effect of FFD_skew
kable(prettify(summary(lm(sqrt(prop_pred_seeds) ~ FFD_kurt,data=data_sel_agg)))) #No effect of FFD_kurt
grid.arrange(
ggplot(data_sel_agg,aes(year,fr_set))+geom_point(),
ggplot(data_sel_agg,aes(year,seed_set))+geom_point(),
ncol=2)
#Fit univariate linear models of fruit set against each predictor (climatic variables)
models_frset<-lapply(varlist, function(x) {
summary(lm(substitute(fr_set ~ scale(i), list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_frset<-cbind(varlist,
plyr::ldply(models_frset, function(x) coef(x)[2]),
plyr::ldply(models_frset, function(x) coef(x)[8]),
plyr::ldply(models_frset, function(x) x$adj.r.squared)
)
names(models_frset)<-c("variable","estimate","p","rsquare")
models_frset$sig<-ifelse(models_frset$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_frset,sig=="*"),desc(rsquare)))
kable(prettify(summary(lm(fr_set ~ FFD_mean,data=data_sel_agg)))) #No effect of FFD_mean FFD
kable(prettify(summary(lm(fr_set ~ FFD_var,data=data_sel_agg)))) #FFD_var*
summary(lm(fr_set ~ FFD_var,data=data_sel_agg))$adj.r.square
ggplot(data_sel_agg,aes(x=FFD_var,y=fr_set))+geom_point()+geom_smooth(method="lm")+
xlab("Variance of FFD")+ylab("Fruit set")
kable(prettify(summary(lm(fr_set ~ FFD_dur,data=data_sel_agg)))) #No effect of FFD_dur
kable(prettify(summary(lm(fr_set ~ FFD_skew,data=data_sel_agg)))) #No effect of FFD_skew
kable(prettify(summary(lm(fr_set ~ FFD_kurt,data=data_sel_agg)))) #No effect of FFD_kurt
#Fit univariate linear models of fruit set against each predictor (climatic variables)
models_seedset<-lapply(varlist, function(x) {
summary(lm(substitute(seed_set ~ scale(i), list(i = as.name(x))),data=data_sel_agg))})
#Build a table with estimate, p and r square for all fitted models
models_seedset<-cbind(varlist,
plyr::ldply(models_seedset, function(x) coef(x)[2]),
plyr::ldply(models_seedset, function(x) coef(x)[8]),
plyr::ldply(models_seedset, function(x) x$adj.r.squared)
)
names(models_seedset)<-c("variable","estimate","p","rsquare")
models_seedset$sig<-ifelse(models_seedset$p<0.05,"*","") # *=p<0.05
#Order models with significant variables by R square
kable(arrange(subset(models_seedset,sig=="*"),desc(rsquare)))
summary(lm(seed_set~scale(precipitation_6),data=data_sel_agg))
ggplot(data_sel_agg,aes(x=precipitation_6,y=seed_set))+geom_point()+
geom_smooth(method="lm")+xlab("Sum of precipitation in June")+
ylab("Seed set (n seeds/n ovules)")
kable(prettify(summary(lm(seed_set ~ FFD_mean,data=data_sel_agg)))) #No effect of FFD_mean
kable(prettify(summary(lm(seed_set ~ FFD_var,data=data_sel_agg)))) #No effect of FFD_var
kable(prettify(summary(lm(seed_set ~ FFD_dur,data=data_sel_agg)))) #No effect of FFD_dur
kable(prettify(summary(lm(seed_set ~ FFD_skew,data=data_sel_agg)))) #No effect of FFD_skew
kable(prettify(summary(lm(seed_set ~ FFD_kurt,data=data_sel_agg)))) #No effect of FFD_kurt
head(alldata)
alldata<-read.csv("C:/Users/User/Dropbox/SU/Projects/lathyrus/data/clean/alldata.csv",
header=T,sep="\t",dec=".") #Read data
head(alldata)
par(mfrow=c(2,4))
boxplot(alldata$grazing,main="grazing")
boxplot(alldata$shoot_vol,main="shoot_volume")
boxplot(alldata$cum_n_fl,main="n_fl")
boxplot(alldata$n_fr,main="n_fr")
boxplot(alldata$n_ovules,main="n_ovules")
boxplot(alldata$n_seeds,main="n_seeds")
boxplot(alldata$n_intact_seeds,main="n_intact_seeds")
boxplot(alldata$FFD,main="FFD")
Z <- cbind(alldata$grazing, alldata$shoot_vol,
alldata$n_fl,alldata$n_fr,
alldata$n_ovules,alldata$n_seeds,
alldata$n_intact_seeds,alldata$FFD)
colnames(Z) <- c("grazing","shoot_vol","n_fl","n_fr","n_ovules",
"n_seeds","n_intact_seeds","FFD")
dotplot(as.matrix(Z), groups = FALSE,
strip = strip.custom(bg = 'white',
par.strip.text = list(cex = 0.8)),
scales = list(x = list(relation = "free"),
y = list(relation = "free"),
draw = F),
col = 1, cex  = 0.5, pch = 16,
xlab = "Value of the variable",
ylab = "Order of the data from text file")
warnings()
