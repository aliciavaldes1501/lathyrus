nrow(alldata_agg)
nrow(alldata_weather_subs)
nrow(data_sel)
write.table(data_sel,
file="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/data/clean/data_sel.csv",
sep="\t",dec=",",col.names=T,row.names=F)
knitr::opts_chunk$set(echo = TRUE)
write.table(data_sel,
file="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/data/clean/data_sel.csv",
sep=",",dec=".",col.names=T,row.names=F)
knitr::opts_chunk$set(echo = TRUE)
write.table(data_sel,
file="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/data/clean/data_sel.csv",
sep="\t",dec=",",col.names=T,row.names=F)
subset_model
library(tidyr)
library(plyr)
library(sjPlot)
library(ggplot2)
library(fmsb)
library(xtable)
library(gridExtra)
library(MASS)
options(xtable.floating = FALSE)
options(xtable.timestamp = "")
options(xtable.comment = FALSE)
data_imput<-read.table("C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/data/clean/data_20062017_forimput.csv",
header=T,sep="\t",dec=",") #Read all data
bud_sizes<-read.table("C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/data/clean/bud_sizes.csv",
header=T,sep="\t",dec=",") #Read data on bud sizes
head(data_imput)
str(data_imput)
data_imput$FFD_corr<-as.Date(as.character(data_imput$FFD_corr),format="%d/%m/%Y")
data_imput$vernal<-as.POSIXct(data_imput$vernal,format="%d/%m/%y %H:%M")
data_imput$FFD<-as.numeric(with(data_imput,as.POSIXct(FFD_corr)-vernal))
subset(data_imput,n_fr>cum_n_fl) #4 cases where n_fruits>n_flowers --> fix
#Equal n_fl to n_fr
data_imput$cum_n_fl<-with(data_imput,ifelse(n_fr>cum_n_fl,n_fr,cum_n_fl))
head(bud_sizes)
bud_sizes[sapply(bud_sizes, function(x) all(is.na(x)))] <- NULL #remove columns with all NAs
str(bud_sizes)
bud_sizes<-gather(bud_sizes, key=day, value=bud_size, X114:X148,factor_key=T) #Convert from wide to long
bud_sizes<-subset(bud_sizes,!bud_size=="") #remove rows with blank bud_size
bud_sizes$day<-as.integer(substring(as.character(bud_sizes$day),2))
bud_sizes$bud_size[bud_sizes$bud_size=="S"] <- 1
bud_sizes$bud_size[bud_sizes$bud_size=="M"] <- 2
bud_sizes$bud_size[bud_sizes$bud_size=="L"] <- 3
bud_sizes$bud_size[bud_sizes$bud_size=="XL"] <-4
bud_sizes$bud_size<-as.integer(bud_sizes$bud_size)
head(bud_sizes)
str(bud_sizes)
#subset to use for building a model of FFD against bud size and day
subset_model<-subset(bud_sizes,!FFD_action=="impute")
with(subset_model,hist(FFD_julian,breaks=50))
with(subset_model,hist(bud_size))
with(subset_model,hist(day))
with(subset_model,plot(as.factor(bud_size)~day))
with(subset_model,plot(FFD_julian~as.factor(bud_size)))
with(subset_model,plot(FFD_julian~day))
subset_model
str(subset_model)
droplevels(subset_model$id)
subset_model$id
table(subset_model$id)
plot(subset_model$id)
n(subset_model$id)
nobs(subset_model$id)
nrow(subset_model$id)
length(subset_model$id)
length(unique(subset_model$id))
model_FFD<-lm(FFD_julian~bud_size*day,subset_model)
summary(model_FFD)
par(mfrow=c(2,2))
plot(model_FFD)
model_FFD06<-lm(FFD_julian~bud_size+day,subset(subset_model,year==2006))
model_FFD07<-lm(FFD_julian~bud_size+day,subset(subset_model,year==2007))
model_FFD08<-lm(FFD_julian~bud_size+day,subset(subset_model,year==2008))
model_FFD09<-lm(FFD_julian~bud_size+day,subset(subset_model,year==2009))
model_FFD10<-lm(FFD_julian~bud_size*day,subset(subset_model,year==2010))
model_FFD11<-lm(FFD_julian~bud_size*day,subset(subset_model,year==2011))
model_FFD12<-lm(FFD_julian~bud_size*day,subset(subset_model,year==2012))
model_FFD13<-lm(FFD_julian~bud_size*day,subset(subset_model,year==2013))
model_FFD14<-lm(FFD_julian~bud_size*day,subset(subset_model,year==2014))
model_FFD15<-lm(FFD_julian~bud_size+day,subset(subset_model,year==2015))
summary(model_FFD06)
summary(model_FFD07)
summary(model_FFD08)
summary(model_FFD09)
summary(model_FFD10)
summary(model_FFD11)
summary(model_FFD12)
summary(model_FFD13)
summary(model_FFD14)
summary(model_FFD15)
data06<-data.frame(observed=subset(subset_model,year==2006)$FFD_julian, predicted=predict(model_FFD06))
data07<-data.frame(observed=subset(subset_model,year==2007)$FFD_julian, predicted=predict(model_FFD07))
data08<-data.frame(observed=subset(subset_model,year==2008)$FFD_julian, predicted=predict(model_FFD08))
data09<-data.frame(observed=subset(subset_model,year==2009)$FFD_julian, predicted=predict(model_FFD09))
data10<-data.frame(observed=subset(subset_model,year==2010)$FFD_julian, predicted=predict(model_FFD10))
data11<-data.frame(observed=subset(subset_model,year==2011)$FFD_julian, predicted=predict(model_FFD11))
data12<-data.frame(observed=subset(subset_model,year==2012)$FFD_julian, predicted=predict(model_FFD12))
data13<-data.frame(observed=subset(subset_model,year==2013)$FFD_julian, predicted=predict(model_FFD13))
data14<-data.frame(observed=subset(subset_model,year==2014)$FFD_julian, predicted=predict(model_FFD14))
data15<-data.frame(observed=subset(subset_model,year==2015)$FFD_julian, predicted=predict(model_FFD15))
grid.arrange(
ggplot(data06) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2006"),
ggplot(data07) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2007"),
ggplot(data08) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2008"),
ggplot(data09) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2009"),
ggplot(data10) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2010"),
ggplot(data11) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2011"),
ggplot(data12) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2012"),
ggplot(data13) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2013"),
ggplot(data14) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2014"),
ggplot(data15) +geom_density(aes(x=observed),alpha=.3, fill="blue")+geom_density(aes(x=predicted),alpha=.3, fill="red")+ggtitle("2015"),
ncol=3)
#Use per-year models
#to predict FFD values where FFD_action=biased/imp_bdsize/impute
predict06<-as.data.frame(predict(model_FFD06,newdata=subset(subset(bud_sizes,year==2006),FFD_action=="impute")))
predict07<-as.data.frame(predict(model_FFD07,newdata=subset(subset(bud_sizes,year==2007),FFD_action=="impute")))
predict08<-as.data.frame(predict(model_FFD08,newdata=subset(subset(bud_sizes,year==2008),FFD_action=="impute")))
predict09<-as.data.frame(predict(model_FFD09,newdata=subset(subset(bud_sizes,year==2009),FFD_action=="impute")))
predict10<-as.data.frame(predict(model_FFD10,newdata=subset(subset(bud_sizes,year==2010),FFD_action=="impute")))
predict11<-as.data.frame(predict(model_FFD11,newdata=subset(subset(bud_sizes,year==2011),FFD_action=="impute")))
predict12<-as.data.frame(predict(model_FFD12,newdata=subset(subset(bud_sizes,year==2012),FFD_action=="impute")))
predict13<-as.data.frame(predict(model_FFD13,newdata=subset(subset(bud_sizes,year==2013),FFD_action=="impute")))
predict14<-as.data.frame(predict(model_FFD14,newdata=subset(subset(bud_sizes,year==2014),FFD_action=="impute")))
predict15<-as.data.frame(predict(model_FFD15,newdata=subset(subset(bud_sizes,year==2015),FFD_action=="impute")))
names(predict06)<-c("FFD_i")
names(predict07)<-c("FFD_i")
names(predict08)<-c("FFD_i")
names(predict09)<-c("FFD_i")
names(predict10)<-c("FFD_i")
names(predict11)<-c("FFD_i")
names(predict12)<-c("FFD_i")
names(predict13)<-c("FFD_i")
names(predict14)<-c("FFD_i")
names(predict15)<-c("FFD_i")
predictions<-rbind(predict06,predict07,predict08,predict09,predict10,predict11,predict12,predict13,predict14,predict15)
bud_sizes<-merge(bud_sizes, predictions, by="row.names",all.x=T) #New colum with imputed FFD (FFD_i) for pls where FFD_action=biased/imp_bdsize/impute
bud_sizes$Row.names<-NULL
bud_sizes<-unique(bud_sizes[c("year", "id","FFD_julian","FFD_action","FFD_i")])
bud_sizes$FFD_buds<-ifelse(is.na(bud_sizes$FFD_julian),bud_sizes$FFD_i,bud_sizes$FFD_julian)
bud_sizes$FFD_imputed<-ifelse(bud_sizes$FFD_action=="impute",1,0) #Says if FFD was imputed (1) or not (0)
head(bud_sizes)
str(bud_sizes)
#merge with data imput
data_imput<-merge(data_imput,bud_sizes[c(1:2,6,7)],by=c("year","id"),all.x=T,all.y=T)
data_imput$FFD<-ifelse(is.na(data_imput$FFD),data_imput$FFD_buds,data_imput$FFD)
data_imput$FFD_buds<-NULL
head(data_imput)
str(data_imput)
subset(data.frame(with(data_imput,table(year,id))),Freq>1) #No repeated ids!
knitr::opts_chunk$set(echo = TRUE)
plot_seldiffs1<-grid.arrange(
ggplot(subset(seldiffs,term=="FFD_std"|term=="n_fl_std"), aes(x=year, y=estimate,colour=term,shape=sig))+
geom_errorbar(aes(ymin=estimate-std.error, ymax=estimate+std.error), width=.3,position=position_dodge(0.5))+
geom_line(position=position_dodge(0.5))+geom_point(size=3,position=position_dodge(0.5))+
scale_colour_manual(values = c("Black", "#999999"))+scale_shape_manual(values=c(1,19))+
xlab(NULL)+ylab("Linear selection differential")+ggtitle("A)")+
geom_hline(yintercept=0,size=0.5,colour="grey",linetype="dashed")+my_theme(),
ggplot(subset(seldiffs,term=="I(FFD_std^2)"|term=="I(n_fl_std^2)"), aes(x=year, y=estimate*2,colour=term,shape=sig))+
geom_errorbar(aes(ymin=estimate*2-std.error, ymax=estimate*2+std.error), width=.3,position=position_dodge(0.5))+
geom_line(position=position_dodge(0.5))+geom_point(size=3,position=position_dodge(0.5))+
scale_colour_manual(values = c("Black", "#999999"))+scale_shape_manual(values=c(1,19))+
xlab("Year")+ylab("Quadratic selection differential")+ggtitle("B)")+
geom_hline(yintercept=0,size=0.5,colour="grey",linetype="dashed")+my_theme(),
ncol=1)
library(broom)
library(knitr)
library(car)
library(ggplot2)
library(fmsb)
library(gridExtra)
library(papeR)
library(agricolae)
library(ggthemes)
library(ggpubr)
library(lemon)
library(grid)
library(lme4)
library(lmerTest)
library(Rmisc)
library(dplyr)
library(MuMIn)
library(effects)
library(parallel)
library(beepr)
library(RColorBrewer)
library(ggridges)
library(tidyverse)
library(sciplot)
library(tidyr)
library(lubridate)
library(knitr)
library(reshape)
library(pander)
library(moments)
library(papeR)
library(MCMCglmm)
plot_seldiffs1<-grid.arrange(
ggplot(subset(seldiffs,term=="FFD_std"|term=="n_fl_std"), aes(x=year, y=estimate,colour=term,shape=sig))+
geom_errorbar(aes(ymin=estimate-std.error, ymax=estimate+std.error), width=.3,position=position_dodge(0.5))+
geom_line(position=position_dodge(0.5))+geom_point(size=3,position=position_dodge(0.5))+
scale_colour_manual(values = c("Black", "#999999"))+scale_shape_manual(values=c(1,19))+
xlab(NULL)+ylab("Linear selection differential")+ggtitle("A)")+
geom_hline(yintercept=0,size=0.5,colour="grey",linetype="dashed")+my_theme(),
ggplot(subset(seldiffs,term=="I(FFD_std^2)"|term=="I(n_fl_std^2)"), aes(x=year, y=estimate*2,colour=term,shape=sig))+
geom_errorbar(aes(ymin=estimate*2-std.error, ymax=estimate*2+std.error), width=.3,position=position_dodge(0.5))+
geom_line(position=position_dodge(0.5))+geom_point(size=3,position=position_dodge(0.5))+
scale_colour_manual(values = c("Black", "#999999"))+scale_shape_manual(values=c(1,19))+
xlab("Year")+ylab("Quadratic selection differential")+ggtitle("B)")+
geom_hline(yintercept=0,size=0.5,colour="grey",linetype="dashed")+my_theme(),
ncol=1)
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/seldiffs1.tiff",
plot=plot_seldiffs1,device="tiff",width=25,height=25,units="cm",dpi=300,compression="lzw")
plot_seldiffs2<-grid_arrange_shared_legend(
ggplot(data_sel,aes(x=FFD_std,y=n_intact_seeds_rel,color=year))+geom_smooth(method="lm",se=F)+
xlab(NULL)+ylab("Relative number of intact seeds")+
theme_base()+theme(plot.background=element_rect(fill="white", colour=NA))+my_theme()+
ggtitle("A)")+theme(plot.title = element_text(hjust =-0.15)),
ggplot(data_sel,aes(x=n_fl_std,y=n_intact_seeds_rel,color=year))+geom_smooth(method="lm",se=F)+
xlab(NULL)+ylab(NULL)+
theme_base()+theme(plot.background=element_rect(fill="white", colour=NA))+my_theme()+
ggtitle("A)")+theme(plot.title = element_text(hjust =-0.15,color="white")),
ggplot(data_sel,aes(x=FFD_std,y=n_intact_seeds_rel,color=year))+
geom_smooth(method = "lm", formula = y ~ x + I(x^2), se=F)+
xlab("Standardized first flowering date")+ylab("Relative number of intact seeds")+
theme_base()+theme(plot.background=element_rect(fill="white", colour=NA))+my_theme()+
ggtitle("B)")+theme(plot.title = element_text(hjust =-0.15)),
ggplot(data_sel,aes(x=n_fl_std,y=n_intact_seeds_rel,color=year))+
geom_smooth(method = "lm", formula = y ~ x + I(x^2), se=F)+
xlab("Standardized number of flowers")+ylab(NULL)+
theme_base()+theme(plot.background=element_rect(fill="white", colour=NA))+my_theme()+
ggtitle("B)")+theme(plot.title = element_text(hjust =-0.15,color="white")),
ncol=2,nrow=2,position="right")
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/seldiffs2.tiff",
plot=plot_seldiffs2,device="tiff",width=25,height=20,units="cm",dpi=300,compression="lzw")
plot_seldiffs3<-ggplot(data_sel,aes(x=FFD_std,y=n_intact_seeds_rel))+facet_wrap(~year,ncol=4)+
geom_smooth(method="lm",se=T,color="black",fill="#999999",size=0.6)+
geom_smooth(method = "lm", formula = y ~ x + I(x^2), se=T,fill="#99CCFF",size=0.6)+
xlab("Standardized first flowering date")+ylab("Relative number of intact seeds")+
my_theme()
plot_seldiffs3
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/seldiffs3.tiff",
plot=plot_seldiffs3,device="tiff",width=14,height=22,units="cm",dpi=300,compression="lzw")
plot_seldiffs4<-ggplot(data_sel,aes(x=n_fl_std,y=n_intact_seeds_rel))+facet_wrap(~year,ncol=4)+
geom_smooth(method="lm",se=T,color="black",fill="#999999",size=0.6)+
geom_smooth(method = "lm", formula = y ~ x + I(x^2), se=T,fill="#99CCFF",size=0.6)+
xlab("Standardized number of flowers")+ylab("Relative number of intact seeds")+
my_theme()
plot_seldiffs4
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/seldiffs4.tiff",
plot=plot_seldiffs4,device="tiff",width=14,height=22,units="cm",dpi=300,compression="lzw")
plot_selgrads1<-ggplot(subset(selgrads_FFD,term=="FFD_std"), aes(x=year, y=estimate,colour=term,shape=sig))+
geom_errorbar(aes(ymin=estimate-std.error, ymax=estimate+std.error), width=.3,position=position_dodge(0.5))+
geom_line(position=position_dodge(0.5))+geom_point(size=3,position=position_dodge(0.5))+
scale_colour_manual(values = c("Black", "#999999"))+scale_shape_manual(values=c(1,19))+
xlab("Year")+ylab("Linear selection gradient for first flowering day")+
geom_hline(yintercept=0,size=0.5,colour="grey",linetype="dashed")+my_theme()
plot_selgrads1
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/selgrads1.tiff",
plot=plot_selgrads1,device="tiff",width=25,height=12,units="cm",dpi=300,compression="lzw")
#This will be part of Fig. 1?
fig1<-grid.arrange(
# Spring temperature
ggplot(summarySE(subset(subset(weather,year>1986),month==3|month==4|month==5),
measurevar="mean", groupvars=c("year","month")),
aes(x=as.integer(as.character(year)),y=mean,color=as.factor(month)))+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.3)+geom_point(size=3)+
xlab(NULL)+ylab("\nMean daily temperature")+ggtitle("A)")+my_theme()+
scale_x_continuous(breaks=seq(1987,2017,2))+
scale_color_manual(values=c("gray85","gray53","black")),
# FFD
ggplot(summarySE(data_sel, measurevar="FFD", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=FFD))+geom_point()+
geom_errorbar(aes(ymin=FFD-se, ymax=FFD+se), width=.3)+ geom_point(size=3)+
geom_smooth(method="lm",color="black",se=F)+
scale_x_continuous(breaks=seq(1987,2017,2))+
xlab(NULL)+ylab("\nFirst flowering date")+ggtitle("B)")+my_theme(),
# Fitness
ggplot(summarySE(data_sel, measurevar="n_intact_seeds", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=n_intact_seeds))+geom_point()+
geom_errorbar(aes(ymin=n_intact_seeds-se, ymax=n_intact_seeds+se), width=.3)+ geom_point(size=3)+
scale_x_continuous(breaks=seq(1987,2017,2))+
xlab(NULL)+ylab("\nNumber of intact seeds")+ggtitle("C)")+my_theme(),
# Linear selection gradients for FFD
ggplot(subset(selgrads_FFD,term=="FFD_std"),
aes(x=as.integer(as.character(year)), y=estimate,colour=term,shape=sig))+
geom_errorbar(aes(ymin=estimate-std.error, ymax=estimate+std.error), width=.3,position=position_dodge(0.5))+
geom_point(size=3,position=position_dodge(0.5))+
scale_colour_manual(values = c("Black", "#999999"))+scale_shape_manual(values=c(1,19))+
scale_x_continuous(breaks=seq(1987,2017,2))+
xlab("Year")+ylab("Selection gradient\nfor first flowering date")+
geom_hline(yintercept=0,size=0.5,colour="grey",linetype="dashed")+ggtitle("D)")+my_theme(),
ncol=1)
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/fig1.tiff",
plot=fig1,device="tiff",width=25,height=36,units="cm",dpi=300,compression="lzw")
figS1<-grid.arrange(
ggplot(summarySE(subset(subset(weather,year>1960),month==3),measurevar="min", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=min))+
geom_errorbar(aes(ymin=min-se, ymax=min+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("A)")+
xlab(NULL)+ylab("Min daily temperature March")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(-10,-8,-6,-4,-2,0,2,4,6,8))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ggplot(summarySE(subset(subset(weather,year>1960),month==4),measurevar="min", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=min))+
geom_errorbar(aes(ymin=min-se, ymax=min+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("B)")+
xlab(NULL)+ylab("Min daily temperature April")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(-10,-8,-6,-4,-2,0,2,4,6,8))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ggplot(summarySE(subset(subset(weather,year>1960),month==5),measurevar="min", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=min))+
geom_errorbar(aes(ymin=min-se, ymax=min+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("C)")+
xlab("Year")+ylab("Min daily temperature May")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(-10,-8,-6,-4,-2,0,2,4,6,8))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ncol=1)
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/figS1.tiff",
plot=figS1,device="tiff",width=25,height=33,units="cm",dpi=300,compression="lzw")
figS2<-grid.arrange(
ggplot(summarySE(subset(subset(weather,year>1960),month==3),measurevar="mean", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=mean))+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("A)")+
xlab(NULL)+ylab("Mean daily temperature March")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(-10,-8,-6,-4,-2,0,2,4,6,8))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ggplot(summarySE(subset(subset(weather,year>1960),month==4),measurevar="mean", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=mean))+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("B)")+
xlab(NULL)+ylab("Mean daily temperature April")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(-10,-8,-6,-4,-2,0,2,4,6,8))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ggplot(summarySE(subset(subset(weather,year>1960),month==5),measurevar="mean", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=mean))+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("C)")+
xlab("Year")+ylab("Mean daily temperature May")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(8,10,12,14,16))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ncol=1)
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/figS2.tiff",
plot=figS2,device="tiff",width=25,height=33,units="cm",dpi=300,compression="lzw")
figS3<-grid.arrange(
ggplot(summarySE(subset(subset(weather,year>1960),month==3),measurevar="max", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=max))+
geom_errorbar(aes(ymin=max-se, ymax=max+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("A)")+
xlab(NULL)+ylab("Max daily temperature March")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(0,2,4,6,8,10))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ggplot(summarySE(subset(subset(weather,year>1960),month==4),measurevar="max", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=max))+
geom_errorbar(aes(ymin=max-se, ymax=max+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("B)")+
xlab(NULL)+ylab("Max daily temperature April")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(0,2,4,6,8,10,12,14,16))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ggplot(summarySE(subset(subset(weather,year>1960),month==5),measurevar="max", groupvars=c("year")),
aes(x=as.integer(as.character(year)),y=max))+
geom_errorbar(aes(ymin=max-se, ymax=max+se), width=.1)+geom_point(size=3)+
geom_smooth(method="lm",color="black")+ggtitle("C)")+
xlab("Year")+ylab("Max daily temperature May")+my_theme()+
theme(plot.title=element_text(hjust=-0.06,vjust=-1))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_y_continuous(labels=function(x) format(x, width=3),breaks=c(12,14,16,18,20,22))+
scale_x_continuous(breaks=seq(1961,2017,4)),
ncol=1)
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/figS3.tiff",
plot=figS3,device="tiff",width=25,height=33,units="cm",dpi=300,compression="lzw")
figS4<-grid.arrange(
ggplot(aggregate(precipitation ~ year,data= subset(weather,month==3),FUN=sum))+
aes(x=as.integer(as.character(year)),y=precipitation)+
geom_bar(stat="identity",position = "identity")+
xlab(NULL)+ylab("Precipitation March")+ggtitle("A)")+my_theme()+
scale_y_continuous(labels=function(x) format(x, width=3))+
theme(plot.title=element_text(hjust=-0.07,vjust=0))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_x_continuous(breaks=seq(1945,2017,4)),
ggplot(aggregate(precipitation ~ year+month,data= subset(weather,month==4),FUN=sum))+
aes(x=as.integer(as.character(year)),y=precipitation)+
geom_bar(stat="identity",position = "identity")+
xlab(NULL)+ylab("Precipitation April")+ggtitle("D)")+my_theme()+
scale_y_continuous(labels=function(x) format(x, width=3))+
theme(plot.title=element_text(hjust=-0.07,vjust=0))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_x_continuous(breaks=seq(1945,2017,4)),
ggplot(aggregate(precipitation ~ year+month,data= subset(weather,month==5),FUN=sum))+
aes(x=as.integer(as.character(year)),y=precipitation)+
geom_bar(stat="identity",position = "identity")+
xlab("Year")+ylab("Precipitation May")+ggtitle("C)")+my_theme()+
scale_y_continuous(labels=function(x) format(x, width=3))+
theme(plot.title=element_text(hjust=-0.07,vjust=0))+
theme(plot.margin = unit(c(0.01,0.1,0.01,0.1), "cm"))+
scale_x_continuous(breaks=seq(1945,2017,4)),
ncol=1)
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/figS4.tiff",
plot=figS4,device="tiff",width=25,height=33,units="cm",dpi=300,compression="lzw")
fig2<-grid.arrange(
ggplot(data_sel,aes(x=mean_4,y=FFD))+ggtitle("A)")+
geom_point(size=1)+geom_smooth(method="lm",color="black",se=F)+
xlab("Mean daily temperature April")+ylab(NULL)+my_theme()+
theme(plot.title=element_text(hjust=-0.13,vjust=2)),
ggplot(data_sel,aes(x=mean_5,y=FFD))+ggtitle("B)")+
geom_point(size=1)+geom_smooth(method="lm",color="black",se=F)+
xlab("Mean daily temperature May")+ylab(NULL)+my_theme()+
theme(axis.text.y=element_text(color="white"))+
theme(plot.title=element_text(hjust=-0.13,vjust=2)),
ggplot(data_sel,aes(x=precipitation_3,y=FFD))+ggtitle("C)")+
geom_point(size=1)+geom_smooth(method="lm",color="black",se=F)+
xlab("Sum of precipitation March")+ylab(NULL)+my_theme()+
theme(axis.text.y=element_text(color="white"))+
theme(plot.title=element_text(hjust=-0.13,vjust=2)),    ggplot(data_sel,aes(x=precipitation_4,y=FFD))+ggtitle("D)")+
geom_point(size=1)+geom_smooth(method="lm",color="black",se=F)+
xlab("Sum of precipitation April")+ylab(NULL)+my_theme()+
theme(axis.text.y=element_text(color="white"))+
theme(plot.title=element_text(hjust=-0.13,vjust=2)),
ncol=4,left=textGrob("First flowering date",just="center",hjust=0.42,
gp=gpar(fontsize=16,fontfamily="serif"),rot = 90))
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/fig2.tiff",
plot=fig2,device="tiff",width=38,height=9,units="cm",dpi=300,compression="lzw")
fig3<-grid.arrange(
ggplot(mean_weather4)+ggtitle("A)")+
geom_point(aes(x=mean_4,y=date_10),shape=24)+
geom_smooth(aes(x=mean_4,y=date_10),method="lm",color="black",lty="dashed",se=F)+
geom_point(aes(x=mean_4,y=FFD_mean),shape=19)+
geom_smooth(aes(x=mean_4,y=FFD_mean),method="lm",color="black",se=F)+
geom_point(aes(x=mean_4,y=date_90),shape=8)+
geom_smooth(aes(x=mean_4,y=date_90),method="lm",color="black",lty="dotted",se=F)+
xlab("Mean daily temperature April")+ylab(NULL)+my_theme()+
scale_y_continuous(limits=c(40,80))+
theme(plot.title=element_text(hjust=-0.13,vjust=1))+
theme(plot.margin = unit(c(0.07,0.2,0.07,0.2), "cm")),
ggplot(mean_weather4)+ggtitle("B)")+
geom_point(aes(x=mean_5,y=date_10),shape=24)+
geom_smooth(aes(x=mean_5,y=date_10),method="lm",color="black",lty="dashed",se=F)+
geom_point(aes(x=mean_5,y=FFD_mean),shape=19)+
geom_smooth(aes(x=mean_5,y=FFD_mean),method="lm",color="black",se=F)+
geom_point(aes(x=mean_5,y=date_90),shape=8)+
geom_smooth(aes(x=mean_5,y=date_90),method="lm",color="black",lty="dotted",se=F)+
xlab("Mean daily temperature May")+ylab(NULL)+my_theme()+
scale_y_continuous(limits=c(40,80))+theme(axis.text.y=element_text(color="white"))+
theme(plot.title=element_text(hjust=-0.13,vjust=1))+
theme(plot.margin = unit(c(0.07,0.2,0.07,0.2), "cm")),
ggplot(mean_weather4)+ggtitle("C)")+
geom_point(aes(x=mean_4,y=days_90_10),shape=19)+
geom_smooth(aes(x=mean_4,y=days_90_10),method="lm",color="black",se=F)+
xlab("Mean daily temperature April")+ylab("Duration of flowering season")+my_theme()+
theme(plot.title=element_text(hjust=-0.13,vjust=1))+
theme(plot.margin = unit(c(0.07,0.2,0.07,0.2), "cm")),
ncol=3,left=textGrob("Day from vernal equinox",
gp=gpar(fontsize=16,fontfamily="serif"),rot = 90,hjust=0.46))
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/fig3.tiff",
plot=fig3,device="tiff",width=28,height=9,units="cm",dpi=300,compression="lzw")
subset4<-data_sel[c(3,44:46,158:160,170:172,182:184,194:196)]
modsel_sig<-lmer(n_intact_seeds_rel ~ FFD_std+n_fl_std+FFD_std:min_4+FFD_std:precipitation_3+
FFD_std:precipitation_4+(1|id),
data = subset4,REML=FALSE,na.action="na.fail")
interaction1<-data.frame(effect(term="FFD_std:min_4",mod=modsel_sig,
xlevels=list(FFD_std=seq(-3.9,4.2,0.1),
min_4=seq(-0.1,3.7,0.1))))
interaction1$fit_mod<-with(interaction1,ifelse(fit<0,0,fit))
interaction2<-data.frame(effect(term="FFD_std:precipitation_3",mod=modsel_sig,
xlevels=list(FFD_std=seq(-3.9,4.2,0.1),
precipitation_3=seq(4.8,78.2,1))))
interaction2$fit_mod<-with(interaction2,ifelse(fit<0,0,fit))
myPalette <- colorRampPalette(brewer.pal(11, "YlOrRd"))
p1<-ggplot(interaction1, aes(FFD_std,fit_mod, group = as.factor(min_4)))+
geom_smooth(method=lm,se=F,size=0.5,aes(FFD_std,fit_mod,color=min_4))+
xlab("Standardized first flowering date")+ylab(NULL)+ggtitle("A)")+
my_theme()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Minimum daily\ntemperature April")+
theme(plot.margin = unit(c(0.1,0.3,0.1,0.3), "cm"))+
theme(plot.title=element_text(hjust=-0.10,vjust=-16))+
scale_y_continuous(limit=c(0,3.2))
myPalette <- colorRampPalette(brewer.pal(11, "Blues"))
p2<-ggplot(interaction2, aes(FFD_std,fit_mod, group = as.factor(precipitation_3)))+
geom_smooth(method=lm,se=F,size=0.5,aes(FFD_std,fit_mod,color=precipitation_3))+
xlab("Standardized first flowering date")+ylab(NULL)+ggtitle("B)")+
my_theme()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Sum of\nprecipitation March")+
theme(axis.text.y=element_text(color="white"))+
theme(plot.margin = unit(c(0.1,0.3,0.1,0.3), "cm"))+
theme(plot.title=element_text(hjust=-0.10,vjust=-16))+
scale_y_continuous(limit=c(0,3.2))
fig4<-grid.arrange(p1,p2,ncol=2,
left=textGrob("Relative number of intact seeds",
just="center",hjust=0.63,
gp=gpar(fontsize=16,fontfamily="serif"),rot = 90))
ggsave(filename="C:/Users/User/Dropbox/SU/Projects/lathyrus/lathyrus_ms1/results/figures/fig4.tiff",
plot=fig4,device="tiff",width=19,height=11,units="cm",dpi=300,compression="lzw")
